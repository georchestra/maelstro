From 7708ff6453b48253f9047c6afc20c11e05e99e04 Mon Sep 17 00:00:00 2001
From: Jean-Michel Crepel <jean-michel.crepel@camptocamp.com>
Date: Tue, 21 Jan 2025 10:17:24 +0100
Subject: [PATCH] tweat gateway and security-proxy config to host maelstro
 backend service

---
 gateway/routes.yaml                       | 10 +++++++++-
 security-proxy/security-proxy.properties  |  2 +-
 security-proxy/targets-mapping.properties |  1 +
 3 files changed, 11 insertions(+), 2 deletions(-)

diff --git a/gateway/routes.yaml b/gateway/routes.yaml
index 86c25b9..3ca3c2f 100644
--- a/gateway/routes.yaml
+++ b/gateway/routes.yaml
@@ -10,7 +10,7 @@ spring:
         predicates:
         - Path=/
         filters:
-        - RedirectTo=308, /datahub/
+        - RedirectTo=308, /geonetwork/
       - id: header
         uri: ${georchestra.gateway.services.header.target}
         predicates:
@@ -59,6 +59,13 @@ spring:
         uri: ${georchestra.gateway.services.ogc-api-records.target}
         predicates:
         - Path=/ogc-api-records/**
+      - id: maelstro-back
+        uri: ${georchestra.gateway.services.maelstro-back.target}
+        predicates:
+        - Path=/maelstrob/**
+        filters:
+        - RewritePath=/maelstrob/(?<segment>.*),/$\{segment}
+
 
 georchestra.gateway.services:
   console.target: http://${CONSOLE_HOST}:8080/console/
@@ -71,3 +78,4 @@ georchestra.gateway.services:
   import.target: http://${IMPORT_HOST}:80/
   mapstore.target: http://${MAPSTORE_HOST}:8080/mapstore/
   ogc-api-records.target: http://${OGC_API_RECORDS_HOST}:8080/ogc-api-records/
+  maelstro-back.target: http://${MAELSTRO_HOST}:8000/
diff --git a/security-proxy/security-proxy.properties b/security-proxy/security-proxy.properties
index d42ef7a..6a23907 100644
--- a/security-proxy/security-proxy.properties
+++ b/security-proxy/security-proxy.properties
@@ -131,7 +131,7 @@ casTicketValidation=http://${CAS_HOST}:8080/cas
 # The security-proxy will 302 redirect / to the defaultTarget value (/header by default).
 # Change it if your homepage (eg a CMS) is located on /portal/ for instance
 # default: ${headerUrl}
-#defaultTarget=${headerUrl}
+defaultTarget=/geonetwork/
 
 
 # Connection pool settings for the logger appender that inserts OGC request stats on the database
diff --git a/security-proxy/targets-mapping.properties b/security-proxy/targets-mapping.properties
index 1bccb4f..eadd82b 100644
--- a/security-proxy/targets-mapping.properties
+++ b/security-proxy/targets-mapping.properties
@@ -9,3 +9,4 @@ datafeeder=http://${DATAFEEDER_HOST}:8080/datafeeder/
 import=http://${IMPORT_HOST}:80/
 datahub=http://${DATAHUB_HOST}:80/datahub/
 ogc-api-records=http://${OGC_API_RECORDS_HOST}:8080/ogc-api-records/
+maelstrob=http://${MAELSTRO_HOST}:8000/
\ No newline at end of file
-- 
2.34.1

